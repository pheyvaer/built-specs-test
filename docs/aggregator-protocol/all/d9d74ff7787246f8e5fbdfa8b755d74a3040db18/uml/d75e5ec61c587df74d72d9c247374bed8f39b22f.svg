<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="441px" preserveAspectRatio="none" style="width:1118px;height:441px;background:#FFFFFF;" version="1.1" viewBox="0 0 1118 441" width="1118px" zoomAndPan="magnify"><defs/><g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="A" id="part1-lifeline"><g><title>Aggregator Service ..</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="84.0942" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="88" x2="88" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="AAS" id="part2-lifeline"><g><title>Aggregator Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="312.0635" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="315.8501" x2="315.8501" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="URS" id="part3-lifeline"><g><title>Upstream Resource Server .</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="556.9292" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="560.2769" x2="560.2769" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="UAS" id="part4-lifeline"><g><title>Upstream Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="816.4336" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="819.4668" x2="819.4668" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="IdP" id="part5-lifeline"><g><title>Identity Provider .</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="1036.7666" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1040.1909" x2="1040.1909" y1="36.2969" y2="405.8906"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="A" id="part1-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="12" y="24.9951">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="A" id="part1-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="5" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="12" y="424.8857">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="AAS" id="part2-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="188.8501" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="195.8501" y="24.9951">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="AAS" id="part2-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="188.8501" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="195.8501" y="424.8857">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="URS" id="part3-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="215.3047" x="453.2769" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="201.3047" x="460.2769" y="24.9951">Upstream Resource Server &#128230;</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="URS" id="part3-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="215.3047" x="453.2769" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="201.3047" x="460.2769" y="424.8857">Upstream Resource Server &#128230;</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="UAS" id="part4-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="698.4668" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="705.4668" y="24.9951">Upstream Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="UAS" id="part4-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="698.4668" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="705.4668" y="424.8857">Upstream Authorization Server &#128737;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="IdP" id="part5-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="143.1514" x="969.1909" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129.1514" x="976.1909" y="24.9951">Identity Provider &#128272;</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="IdP" id="part5-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="143.1514" x="969.1909" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129.1514" x="976.1909" y="424.8857">Identity Provider &#128272;</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg1"><polygon fill="#181818" points="548.9292,63.4297,558.9292,67.4297,548.9292,71.4297,552.9292,67.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="554.9292" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.2119" x="95.0942" y="62.3638">1. Request resource (no access token)</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg2"><polygon fill="#181818" points="808.4336,92.5625,818.4336,96.5625,808.4336,100.5625,812.4336,96.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="560.9292" x2="814.4336" y1="96.5625" y2="96.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235.5044" x="567.9292" y="91.4966">1.1 Request UMA ticket for resource</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg3"><polygon fill="#181818" points="571.9292,121.6953,561.9292,125.6953,571.9292,129.6953,567.9292,125.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="565.9292" x2="819.4336" y1="125.6953" y2="125.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.127" x="577.9292" y="120.6294">1.2 Return UMA ticket</text></g><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg4"><polygon fill="#181818" points="99.0942,150.8281,89.0942,154.8281,99.0942,158.8281,95.0942,154.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="559.9292" y1="154.8281" y2="154.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.4263" x="105.0942" y="149.7622">1.3 401 Unauthorized + UMA ticket</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg5"><polygon fill="#181818" points="808.4336,179.9609,818.4336,183.9609,808.4336,187.9609,812.4336,183.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="814.4336" y1="183.9609" y2="183.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.812" x="95.0942" y="178.895">2. Request access token</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg6"><polygon fill="#181818" points="1028.7666,209.0938,1038.7666,213.0938,1028.7666,217.0938,1032.7666,213.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="820.4336" x2="1034.7666" y1="213.0938" y2="213.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.1284" x="827.4336" y="208.0278">2.1 Validate ID token</text></g><g class="message" data-entity-1="part5" data-entity-2="part4" id="msg7"><polygon fill="#181818" points="831.4336,238.2266,821.4336,242.2266,831.4336,246.2266,827.4336,242.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="825.4336" x2="1039.7666" y1="242.2266" y2="242.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.333" x="837.4336" y="237.1606">2.2 Validation result (success)</text></g><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg8"><polygon fill="#181818" points="99.0942,267.3594,89.0942,271.3594,99.0942,275.3594,95.0942,271.3594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="819.4336" y1="271.3594" y2="271.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277.0752" x="105.0942" y="266.2935">2.3 Access token + derivation_resource_id</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg9"><polygon fill="#181818" points="548.9292,296.4922,558.9292,300.4922,548.9292,304.4922,552.9292,300.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="554.9292" y1="300.4922" y2="300.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.4561" x="95.0942" y="295.4263">3. Request resource with access token</text></g><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg10"><polygon fill="#181818" points="99.0942,325.625,89.0942,329.625,99.0942,333.625,95.0942,329.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="559.9292" y1="329.625" y2="329.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.4653" x="105.0942" y="324.5591">3.1 Protected resource</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg11"><polygon fill="#181818" points="304.0635,354.7578,314.0635,358.7578,304.0635,362.7578,308.0635,358.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="310.0635" y1="358.7578" y2="358.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.9692" x="95.0942" y="353.6919">4. Update resource registration</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg12"><polygon fill="#181818" points="99.0942,383.8906,89.0942,387.8906,99.0942,391.8906,95.0942,387.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="315.0635" y1="387.8906" y2="387.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.9731" x="105.0942" y="382.8247">4.1 Registration updated</text></g><!--SRC=[XP8nJiD044LxdsAKAX4Ymd4gYaWhqQH0YXAPDbhPWxEAMPlrE2XS0YHeW0BHS0REmmNW2Cok7Tj4H3JRxF_pt_pTOgrqBesy0Zv9HIgNcXQqJH4CHYHragBdTUwW9vB4O28fCx10ir4HmkVpqzV7NGza0UAWM9IqoeowbQGoxQneuFlrvQsnYiLlSvWNP93PvbXafU6WnlNmxYpX_93btxHmFsqQeoP5MvYPRADY9t-yTzffFFCy0SSJ6tWA_f29haiiY4kgoVew0nb5M1H0sHhrm6EfSmZdy1jBU2w0KzT8SCcrx2PuB8JZDcB41YgDxkYhaImHLX30-CI7KCjwKupXg2kkWMtyg0NkCbQH4xkUrVXm8LCLIqAOdjKAlggWgZ6ZdSIMokHbIj0lIZTpq6mWh3G0qObYD6vKRPnpkTjvgU9khy4VlTueMkr1joK4pColHVnJUVkcoMgaiCZZ8OIvMwcPoFzHyITn99veaSVkZTexA9qn_W40]--></g></svg>