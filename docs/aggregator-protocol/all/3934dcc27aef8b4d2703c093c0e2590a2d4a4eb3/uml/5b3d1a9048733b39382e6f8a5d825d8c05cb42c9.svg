<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="826px" preserveAspectRatio="none" style="width:949px;height:826px;background:#FFFFFF;" version="1.1" viewBox="0 0 949 826" width="949px" zoomAndPan="magnify"><defs/><g><g><title>Client ...</title><rect fill="#000000" fill-opacity="0.00000" height="755.1172" width="8" x="38.8916" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="42" x2="42" y1="36.2969" y2="791.4141"/></g><g><title>Aggregator Service ..</title><rect fill="#000000" fill-opacity="0.00000" height="755.1172" width="8" x="293.3179" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="297.2236" x2="297.2236" y1="36.2969" y2="791.4141"/></g><g><title>Aggregator Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="755.1172" width="8" x="552.8223" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="556.6089" x2="556.6089" y1="36.2969" y2="791.4141"/></g><g><title>Upstream Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="755.1172" width="8" x="817.1509" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="820.1841" x2="820.1841" y1="36.2969" y2="791.4141"/></g><g class="participant participant-head" data-participant="C"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.7832" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7832" x="12" y="24.9951">Client &#129489;&#8205;&#128187;</text></g><g class="participant participant-tail" data-participant="C"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.7832" x="5" y="790.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7832" x="12" y="810.4092">Client &#129489;&#8205;&#128187;</text></g><g class="participant participant-head" data-participant="A"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="214.2236" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="221.2236" y="24.9951">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-tail" data-participant="A"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="214.2236" y="790.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="221.2236" y="810.4092">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-head" data-participant="AAS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="429.6089" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="436.6089" y="24.9951">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-participant="AAS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="429.6089" y="790.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="436.6089" y="810.4092">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-head" data-participant="UAS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="699.1841" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="706.1841" y="24.9951">Upstream Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-participant="UAS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="699.1841" y="790.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="706.1841" y="810.4092">Upstream Authorization Server &#128737;&#65039;</text></g><g class="message" data-participant-1="C" data-participant-2="A"><polygon fill="#181818" points="285.3179,78.5625,295.3179,82.5625,285.3179,86.5625,289.3179,82.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="291.3179" y1="82.5625" y2="82.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.1392" x="49.8916" y="62.3638">1. Request derived resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.5703" x="49.8916" y="77.4966">(no or insufficient token)</text></g><g class="message" data-participant-1="A" data-participant-2="AAS"><polygon fill="#181818" points="544.8223,107.6953,554.8223,111.6953,544.8223,115.6953,548.8223,111.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="297.3179" x2="550.8223" y1="111.6953" y2="111.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235.5044" x="304.3179" y="106.6294">1.1 Request UMA ticket for resource</text></g><g class="message" data-participant-1="AAS" data-participant-2="A"><polygon fill="#181818" points="308.3179,136.8281,298.3179,140.8281,308.3179,144.8281,304.3179,140.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="302.3179" x2="555.8223" y1="140.8281" y2="140.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.9805" x="314.3179" y="135.7622">1.2 Return UMA ticket (tkt-A2)</text></g><g class="message" data-participant-1="A" data-participant-2="C"><polygon fill="#181818" points="53.8916,165.9609,43.8916,169.9609,53.8916,173.9609,49.8916,169.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="296.3179" y1="169.9609" y2="169.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.4263" x="59.8916" y="164.895">1.3 401 Unauthorized + UMA ticket</text></g><g class="message" data-participant-1="C" data-participant-2="AAS"><polygon fill="#181818" points="544.8223,240.4922,554.8223,244.4922,544.8223,248.4922,548.8223,244.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="550.8223" y1="244.4922" y2="244.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2788" x="49.8916" y="194.0278">2. Request permission</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.5767" x="49.8916" y="209.1606">(grant_type=uma-ticket,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.0825" x="54.0239" y="224.2935">ticket=tkt-A2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.1621" x="54.0239" y="239.4263">claim_tokens)</text></g><g class="message" data-participant-1="AAS" data-participant-2="A"><polygon fill="#181818" points="308.3179,284.7578,298.3179,288.7578,308.3179,292.7578,304.3179,288.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="302.3179" x2="555.8223" y1="288.7578" y2="288.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.6733" x="314.3179" y="268.5591">2.1 Introspect existing tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46.3633" x="314.3179" y="283.6919">(if any)</text></g><g class="message" data-participant-1="AAS" data-participant-2="UAS"><polygon fill="#181818" points="809.1509,329.0234,819.1509,333.0234,809.1509,337.0234,813.1509,333.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="556.8223" x2="815.1509" y1="333.0234" y2="333.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.3286" x="563.8223" y="312.8247">2.2 Validate upstream access tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.8218" x="563.8223" y="327.9575">(if provided)</text></g><g class="message" data-participant-1="UAS" data-participant-2="AAS"><polygon fill="#181818" points="567.8223,358.1563,557.8223,362.1563,567.8223,366.1563,563.8223,362.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="561.8223" x2="820.1509" y1="362.1563" y2="362.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.2061" x="573.8223" y="357.0903">2.3 Validation result</text></g><g class="message" data-participant-1="AAS" data-participant-2="C"><polygon fill="#181818" points="53.8916,432.6875,43.8916,436.6875,53.8916,440.6875,49.8916,436.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="555.8223" y1="436.6875" y2="436.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.1753" x="59.8916" y="386.2231">2.4 need_info</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.0991" x="59.8916" y="401.356">(required_claims with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.5674" x="64.0239" y="416.4888">issuer, derivation_resource_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.2676" x="64.0239" y="431.6216">resource_scopes)</text></g><g class="message" data-participant-1="C" data-participant-2="UAS"><polygon fill="#181818" points="809.1509,476.9531,819.1509,480.9531,809.1509,484.9531,813.1509,480.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="815.1509" y1="480.9531" y2="480.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.2783" x="49.8916" y="460.7544">3. Request upstream access token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.438" x="49.8916" y="475.8872">for derivation_resource_id</text></g><g class="message" data-participant-1="UAS" data-participant-2="C"><polygon fill="#181818" points="53.8916,506.0859,43.8916,510.0859,53.8916,514.0859,49.8916,510.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="820.1509" y1="510.0859" y2="510.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.2192" x="59.8916" y="505.02">3.1 Upstream access token(s)</text></g><g class="message" data-participant-1="C" data-participant-2="AAS"><polygon fill="#181818" points="544.8223,550.3516,554.8223,554.3516,544.8223,558.3516,548.8223,554.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="550.8223" y1="554.3516" y2="554.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2788" x="49.8916" y="534.1528">4. Request permission</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.8496" x="49.8916" y="549.2856">with upstream access token(s)</text></g><g class="message" data-participant-1="AAS" data-participant-2="UAS"><polygon fill="#181818" points="809.1509,579.4844,819.1509,583.4844,809.1509,587.4844,813.1509,583.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="556.8223" x2="815.1509" y1="583.4844" y2="583.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.3911" x="563.8223" y="578.4185">4.1 Validate upstream tokens</text></g><g class="message" data-participant-1="UAS" data-participant-2="AAS"><polygon fill="#181818" points="567.8223,608.6172,557.8223,612.6172,567.8223,616.6172,563.8223,612.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="561.8223" x2="820.1509" y1="612.6172" y2="612.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.2061" x="573.8223" y="607.5513">4.2 Validation result</text></g><g class="message" data-participant-1="AAS" data-participant-2="C"><polygon fill="#181818" points="53.8916,637.75,43.8916,641.75,53.8916,645.75,49.8916,641.75" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="555.8223" y1="641.75" y2="641.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.0439" x="59.8916" y="636.6841">4.3 RPT for Aggregator resource</text></g><g class="message" data-participant-1="C" data-participant-2="A"><polygon fill="#181818" points="285.3179,682.0156,295.3179,686.0156,285.3179,690.0156,289.3179,686.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="291.3179" y1="686.0156" y2="686.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.1392" x="49.8916" y="665.8169">5. Request derived resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56.5259" x="49.8916" y="680.9497">with RPT</text></g><g class="message" data-participant-1="A" data-participant-2="AAS"><polygon fill="#181818" points="544.8223,711.1484,554.8223,715.1484,544.8223,719.1484,548.8223,715.1484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="297.3179" x2="550.8223" y1="715.1484" y2="715.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.4883" x="304.3179" y="710.0825">5.1 Introspect RPT</text></g><g class="message" data-participant-1="AAS" data-participant-2="A"><polygon fill="#181818" points="308.3179,740.2813,298.3179,744.2813,308.3179,748.2813,304.3179,744.2813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="302.3179" x2="555.8223" y1="744.2813" y2="744.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.0737" x="314.3179" y="739.2153">5.2 Authorization result</text></g><g class="message" data-participant-1="A" data-participant-2="C"><polygon fill="#181818" points="53.8916,769.4141,43.8916,773.4141,53.8916,777.4141,49.8916,773.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="296.3179" y1="773.4141" y2="773.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.646" x="59.8916" y="768.3481">5.3 Derived resource</text></g><!--SRC=[XLF1ZfH04Btp5PKzpSGTup3CnMHD25uyc9WTyJG9wK31LePfiBiP7K_-W35wKmyRJ_w2YN-pF-1-WjNDme2YNY3GzLwzzwfBxqZMGeazyDDGIhMGPcEE9OB2r0XPbEXvWpCuYqf2VjzUV_jmy_RTxVN77sSWD4JZgh0e51R2L0esg0wK8jny_lJp-tjN7FwrE6pCLQNeZJ1KIGT5nRs-VEsXuMOCZcjj5BA3_q9ZXdeHB1v1-12Mz-4INpQe3MIew80PEzPLerBSofciWCMGr4sUSoThs5Gxb7ClTFXmOncMFKNyD0IMj4C3EGCx9eyBOT4rzBdSD4eEgsTcPnQXxtYvBh9rAmWUB26MuiuGIxitm7GUh0R_vA96jIUjsJlhBnHdavXZZHVDNYnQuFbMtb5Sj5tjZxGKj4-SEJrlzJgvFhjx8esgTCqN0V0rQKEoQ6FGt89o4FBOG-9MZWylH4cPC0XDDnYHfgZr25chwa0PPdClxX9gyQiERsV8CJQbwKECR4404Z5BIEOLKoasJug_dGqDhyXSiIdEeK5rtaxMSINTI1BAhEt-KwTLZUoy3TMvM9r2dVImbNR6qzozdyZoy1Id26PzF-Swc1wYzJ8jOAR7iGVSwC_Osxp70GUd0Kq77F04BfyzTxTui9RzXUxtP_sl_N7IcMQmBUlnVNA7f-LOiwxn_dRIEc5h5lRujqQ_0000]--></g></svg>